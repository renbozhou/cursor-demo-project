# Ptrade 量化交易策略工程

## 项目说明
本项目是基于 Ptrade 平台开发的量化交易策略集合。每个策略以独立的 Python 文件形式存在,可以在 Ptrade 平台上独立运行。

## 环境要求
- Python 3.11
- Ptrade 平台环境
- 仅支持 Ptrade 内置第三方库

## 策略列表
1. 日内策略 - 基于日内行情的交易策略
2. 三因子策略 - 多因子选股策略
3. 海龟止盈止损策略 - 经典海龟交易法则实现
4. 双均线策略 - 基于双均线交叉的交易策略
5. 鸭头策略 - 基于均线和成交量的形态识别策略

## 功能特点
- 支持 tick 级别交易(最小时间粒度 3s)
- 支持多品种交易(股票、ETF、可转债、债券等)
- 支持 T+0 交易(可转债)
- 支持十档行情数据

## 运行环境
- 策略运行在券商机房托管环境
- 支持全自动无人值守运行
- 通过 Ptrade 交易面板进行策略启停控制

## 注意事项
1. 策略运行在内网环境,无法访问外部网络
2. 只能使用 Ptrade 内置的第三方库
3. 需要通过 Ptrade 平台进行策略的开发和测试

## 策略编码规范

### 1. 策略文件结构
每个策略文件应包含以下基本结构：

```python
'''
策略名称：[策略名称]
策略流程：[策略主要流程说明]
Author: [作者]
Version: [版本号]
Date: [日期]
'''

def initialize(context):
    """
    策略初始化函数
    - 定义全局参数配置(g.config)
    - 设置股票池(g.sec_dict)
    - 设置定时任务
    """
    pass

def before_trading_start(context, data):
    """
    每日开盘前执行
    - 输出策略信息
    - 准备当日交易数据
    """
    pass

def daily_event(context):
    """
    主要交易逻辑
    - 获取历史数据
    - 计算交易信号
    - 执行交易指令
    """
    pass

def handle_data(context, data):
    """
    可选的实时处理函数
    - tick级别数据处理
    - 紧急情况处理
    """
    pass
```

### 2. 参数配置规范
- 全局参数使用 `g.config` 字典统一管理
- 股票池使用 `g.sec_dict` 字典管理，格式为 `{"股票代码": 权重}`
- 参数命名应具有描述性，使用下划线命名法
- 关键参数需要添加注释说明

### 3. 数据处理规范
- 使用 `get_history()` 获取历史数据
- 使用 pandas 进行数据处理
- 技术指标计算应独立成函数
- 数据频率和时间窗口需在注释中说明

### 4. 交易规则规范
- 使用 `order()` 函数执行交易
- 交易量应考虑整手(100股)
- 需要实现止盈止损机制
- 应包含仓位管理逻辑

### 5. 日志输出规范
- 使用 `log.info()` 输出关键信息
- 交易执行前后需要记录日志
- 日志内容应包含时间、标的、数量、原因等

### 6. 风控规范
- 必须设置止损条件
- 需要考虑资金利用率
- 单次交易量不超过当日可成交量的 10%
- 总仓位应有上限控制

### 7. 回测要求
- 回测周期不少于一年
- 需要对比基准指数
- 应包含手续费和滑点
- 输出夏普比率、最大回撤等指标

## 示例策略结构
以海龟交易策略为例：
1. 策略参数配置
   - 入场参数(唐奇安通道)
   - ATR 波动率参数
   - 止盈止损参数
   - 仓位管理参数

2. 交易信号生成
   - 计算唐奇安通道
   - 计算 ATR 指标
   - 生成买卖信号

3. 交易规则执行
   - 入场规则
   - 加仓规则
   - 减仓规则
   - 清仓规则

4. 风险控制
   - 波动率止损
   - 固定比例止损
   - 获利止盈
   - 仓位控制

## 会话记录

### 2024-04-23 会话总结
- 会话主要目的：创建鸭头策略并完善日志输出
- 完成的主要任务：
  1. 创建了基于均线和成交量的鸭头形态识别策略
  2. 实现了指数股票池选股功能
  3. 添加了每日资金再平衡机制
  4. 完善了策略核心代码的日志输出
- 关键决策：
  - 使用60日均线作为长期趋势判断
  - 使用5日和10日均线交叉作为交易信号
  - 结合成交量变化确认交易信号
  - 设置单个股票最大仓位为20%
- 技术栈：Python 3.11, Ptrade API, Pandas
- 修改的文件：
  - 新建了 `鸭头策略.txt`
  - 更新了 `Readme.md`
